<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JS客户端检测 | Hello VuePress</title>
    <meta name="description" content="Just playing around">
    
    
    <link rel="preload" href="/vuepress-4/assets/css/0.styles.70f5b477.css" as="style"><link rel="preload" href="/vuepress-4/assets/js/app.1a1f2688.js" as="script"><link rel="preload" href="/vuepress-4/assets/js/2.e8eb7698.js" as="script"><link rel="preload" href="/vuepress-4/assets/js/13.22e388ff.js" as="script"><link rel="prefetch" href="/vuepress-4/assets/js/10.628096f2.js"><link rel="prefetch" href="/vuepress-4/assets/js/11.f01883c8.js"><link rel="prefetch" href="/vuepress-4/assets/js/12.1bbaa6e7.js"><link rel="prefetch" href="/vuepress-4/assets/js/14.09456cb3.js"><link rel="prefetch" href="/vuepress-4/assets/js/3.463fa20f.js"><link rel="prefetch" href="/vuepress-4/assets/js/4.0126fb2a.js"><link rel="prefetch" href="/vuepress-4/assets/js/5.d46e4008.js"><link rel="prefetch" href="/vuepress-4/assets/js/6.733220ed.js"><link rel="prefetch" href="/vuepress-4/assets/js/7.bf784d15.js"><link rel="prefetch" href="/vuepress-4/assets/js/8.07825339.js"><link rel="prefetch" href="/vuepress-4/assets/js/9.8da168e9.js">
    <link rel="stylesheet" href="/vuepress-4/assets/css/0.styles.70f5b477.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/vuepress-4/" class="home-link router-link-active"><!----> <span class="site-name">Hello VuePress</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="js客户端检测"><a href="#js客户端检测" aria-hidden="true" class="header-anchor">#</a> JS客户端检测</h1> <p>客户端检测是Web开发领域中一个饱受争议的话题。人们总会不约而同的的提到浏览器应该提供一组最常用的公共功能。在理想状态下，确实如此。但是，在现实当中，浏览器之间的差异以及不同浏览器的怪癖，多的不胜枚举。因此，客户端检测除了是一种补救措施之外，更是一种行之有效的开发策略。</p> <h2 id="目录"><a href="#目录" aria-hidden="true" class="header-anchor">#</a> 目录</h2> <ul><li><p>能力检测</p></li> <li><p>怪癖检测</p></li> <li><p>用户代理检测</p></li></ul> <h3 id="能力检测"><a href="#能力检测" aria-hidden="true" class="header-anchor">#</a> 能力检测</h3> <p>最常用也最为人们广泛接受的客户端检测形式，又称之为特性检测。不是检测浏览器的类型，而是检测浏览器具备哪些能力。</p> <p>举例：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getElement</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>getElementById<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span>all<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> document<span class="token punctuation">.</span>all<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;No way to retrieve element!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>getElement()</code>函数的用途是返回具有给定ID的元素。<code>document.getElementById()</code>是实现这一目的的标准方式，所以一开始就测了这个方法。如果该函数存在就使用该函数，否则就继续检测<code>document.all</code>是否存在，如果是，则使用它。则创建并抛出错误，表示这个函数无法使用。</p> <p>能力检测需要注意的问题：</p> <ul><li><p>先检测达成目的最常用的特性</p></li> <li><p>必须测试实际要用到的特性。一个特性存在，不一定意味着另一个特性也存在。如下例子</p></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">function</span> <span class="token function">getWindowWidth</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">.</span>all<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 假设IE浏览器</span>
    <span class="token keyword">return</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">.</span>clientWidth<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> window<span class="token punctuation">.</span>innerWidth<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述例子存在的问题是：<code>document.all</code>存在不一定表示的就是IE浏览器，实际上<code>Opera</code>同时支持<code>document.all</code>和<code>window.innerWidth</code>。</p> <h3 id="怪癖检测"><a href="#怪癖检测" aria-hidden="true" class="header-anchor">#</a> 怪癖检测</h3> <p>怪癖检测是用来识别浏览器的特殊行为，即检测浏览器存在的缺陷。例如，IE8及更早版本中存在一个bug，即某个实例属性与<code>[[Enumerable]]]</code>标记为<code>false</code>的某个原型属性名相同，那么该实例属性将不会出现在<code>for-in</code>循环当中。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">hasEnumerable</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> o <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token function-variable function">toString</span> <span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> prop <span class="token keyword">in</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>prop <span class="token operator">==</span> <span class="token string">&quot;toString&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>在正确的<code>ECMAScript</code>实现中，<code>toString</code>应该在<code>for-in</code>循环中作为属性返回。</p> <h3 id="用户代理检测"><a href="#用户代理检测" aria-hidden="true" class="header-anchor">#</a> 用户代理检测</h3> <p>用户代理检测通过检测用户代理字符串来确定实际使用的浏览器。该字符串可以通过<code>JavaScript</code>的<code>navigator.userAgent</code>属性访问。</p> <h4 id="识别呈现引擎"><a href="#识别呈现引擎" aria-hidden="true" class="header-anchor">#</a> 识别呈现引擎</h4> <p>如果<code>Firefox</code>和<code>Netscape</code>都使用相同版本的<code>Gecko</code>，那他们一定支持相同的特性。类似的，不管是什么浏览器，只要它跟<code>Safari3</code>使用的是同一个版本的<code>WebKit</code>，那么该浏览器也就跟<code>Safari</code>具有相同的功能。因此，我们主要检测五大呈现引擎：<code>IE</code>、<code>Gecko</code>、<code>WebKit</code>、<code>KHTML</code> 和<code>Opera</code>。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">//呈现引擎</span>
        ie<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        gecko<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        webkit<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        khtml<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        opera<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
        <span class="token comment">//具体的版本号</span>
        ver<span class="token punctuation">:</span> <span class="token keyword">null</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token comment">//在此检测呈现引擎</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
        engine <span class="token punctuation">:</span> engine
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>想要正确的识别呈现引擎，检测顺序也要正确。第一个识别<code>Opera</code>，因为它的用户代理字符串有可能完全模仿其他浏览器。使用<code>window.opera</code>对象来识别<code>Opera</code>。如下代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span><span class="token punctuation">{</span>
    engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在<code>Opera7.6+</code>版本中，调用<code>version</code>方法可以返回一个表示浏览器版本的字符串。</p> <p>第二个检测的呈现引擎是<code>WebKit</code>。<code>WebKit</code>的用户代理字符串中的<code>AppleWebKit</code>是独一无二的，因此检测这个字符串最合适。示例代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span> 
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token regex">/AppleWebKit\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>接下来要测试的是<code>KHTML</code>，<code>KHTML</code>的用户代理字符串中包含<code>Gecko</code>。因此在排除<code>KHTML</code>之前，无法准确检测基于<code>Gecko</code>的浏览器。下面是相应代码：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/KHTML\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 	engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>在排除<code>WebKit</code>和<code>KHTML</code>之后，就可以准确的检测<code>Gecko</code>了。<code>Gecko</code>的版本号会出现在字符串“rv”的后面。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/rv:([^\)]+)\) Gecko\/\d{8}/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>gecko <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>最后检测的呈现引擎是<code>IE</code>，<code>IE</code>的版本号位于字符串<code>MSIE</code>的后面，相应的正则表达式如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/MSIE ([^;]+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>ie <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="识别浏览器"><a href="#识别浏览器" aria-hidden="true" class="header-anchor">#</a> 识别浏览器</h4> <p>在大多数情况下，识别了浏览器的呈现引擎就可以为我们采取正确的操作提供依据了。但是，呈现引擎还不能说明存在所需的<code>JavaScript</code>功能。比如，苹果公司的<code>Safari</code>浏览器和谷歌公司的<code>Chrome</code>浏览器都使用<code>WebKit</code>作为呈现引擎，但它们的<code>JavaScript</code>引擎却不一样。在这两款浏览器中，<code>client.webkit</code>都会返回非 0值。所以还需要为<code>client</code>对象添加一些浏览器的属性。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">client</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
	<span class="token keyword">var</span> engine <span class="token operator">=</span> <span class="token punctuation">{</span> 
		<span class="token comment">//呈现引擎</span>
 		ie<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
		gecko<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		webkit<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		khtml<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		opera<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>

 		<span class="token comment">//具体的版本</span>
 		ver<span class="token punctuation">:</span> <span class="token keyword">null</span>
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 	<span class="token keyword">var</span> browser <span class="token operator">=</span> <span class="token punctuation">{</span>
 		<span class="token comment">//浏览器</span>
 		ie<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		firefox<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		safari<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		opera<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		chrome<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
 		<span class="token comment">//具体的版本</span>
 		ver<span class="token punctuation">:</span> <span class="token keyword">null</span>
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
 	<span class="token comment">//在此检测呈现引擎、平台和设备</span>
 	<span class="token keyword">return</span> <span class="token punctuation">{</span>
 		engine<span class="token punctuation">:</span> engine<span class="token punctuation">,</span>
 		browser<span class="token punctuation">:</span> browser
 	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>上述代码中添加了私有变量<code>browser</code>，用于保存每个主要浏览器的属性。与<code>engine</code>变量一样，除了当前使用的浏览器，其他属性将保持为0。由于大多数浏览器与其呈现引擎密切相关，所以检测浏览器的代码与呈现引擎的代码是混合在一起的。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//检测呈现引擎及浏览器</span>
<span class="token keyword">var</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>opera<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> window<span class="token punctuation">.</span>opera<span class="token punctuation">.</span><span class="token function">version</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	engine<span class="token punctuation">.</span>opera <span class="token operator">=</span> browser<span class="token punctuation">.</span>opera <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/AppleWebKit\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 	engine<span class="token punctuation">.</span>webkit <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span> 

 	<span class="token comment">//确定是 Chrome 还是 Safari</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/Chrome\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 		browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 		browser<span class="token punctuation">.</span>chrome <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/Version\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 		browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 		browser<span class="token punctuation">.</span>safari <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token punctuation">}</span>
 <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/KHTML\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
 	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 	engine<span class="token punctuation">.</span>khtml <span class="token operator">=</span> browser<span class="token punctuation">.</span>konq <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/rv:([^\)]+)\) Gecko\/\d{8}/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 	engine<span class="token punctuation">.</span>gecko <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>

 	<span class="token comment">//确定是不是 Firefox</span>
 	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/Firefox\/(\S+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 		browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 		browser<span class="token punctuation">.</span>firefox <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>browser<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
 	<span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/MSIE ([^;]+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 	engine<span class="token punctuation">.</span>ver <span class="token operator">=</span> browser<span class="token punctuation">.</span>ver <span class="token operator">=</span> RegExp<span class="token punctuation">[</span><span class="token string">&quot;$1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 	engine<span class="token punctuation">.</span>ie <span class="token operator">=</span> browser<span class="token punctuation">.</span>ie <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span>ver<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> 
</code></pre></div><p>所以根据上述代码，我们就可以编写下面的逻辑</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>webkit<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//if it’s WebKit</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>chrome<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//执行针对Chrome 的代码</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>safari<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//执行针对Safari 的代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>gecko<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>browser<span class="token punctuation">.</span>firefox<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//执行针对Firefox 的代码</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//执行针对其他Gecko 浏览器的代码</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="识别平台"><a href="#识别平台" aria-hidden="true" class="header-anchor">#</a> 识别平台</h4> <p>那些具有各种平台版本的浏览器，比如（Safari、Firefox 和Opera），在不同平台下可能会有不同的问题。目前的三大主流平台是<code>Windows</code>、<code>Mac</code> 和<code>Unix</code>（包括各种<code>Linux</code>）。</p> <p>在确定平台时，只需要检测<code>navigator.platform</code>，<code>navigator.platform</code> 属性可能的值包括&quot;<code>Win32</code>&quot;、&quot;<code>Win64</code>&quot;、&quot;<code>MacIntel</code>&quot;、&quot;<code>X11</code>&quot;和&quot;<code>Linux i686</code>&quot;，这些值在不同的浏览器中都是一致的。检测平台的代码如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> p <span class="token operator">=</span> navigator<span class="token punctuation">.</span>platform<span class="token punctuation">;</span>
system<span class="token punctuation">.</span>win <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Win&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>mac <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Mac&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
system<span class="token punctuation">.</span>x11 <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;X11&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;Linux&quot;</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="识别移动设备"><a href="#识别移动设备" aria-hidden="true" class="header-anchor">#</a> 识别移动设备</h4> <p>检测移动设备想对比较简单，首先获取到<code>navigator.userAgent</code>字符串。</p> <p>检测<code>iOS</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> ua <span class="token operator">=</span> navigator<span class="token punctuation">.</span>userAgent<span class="token punctuation">;</span>
    system<span class="token punctuation">.</span>iphone <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPhone&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    system<span class="token punctuation">.</span>iPad <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;iPad&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>检测<code>Android</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">//检测Android 版本</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token regex">/Android (\d+\.\d+)/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ua<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    system<span class="token punctuation">.</span>android <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>RegExp<span class="token punctuation">.</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>检测<code>NokiaN</code>：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>system<span class="token punctuation">.</span>nokiaN <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">&quot;NokiaN&quot;</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><p>在了解这些设备信息的基础上，就可以通过下列代码来确定用户使用的是什么设备中的<code>WebKit</code>来访问网页：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>engine<span class="token punctuation">.</span>webkit<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span> iOS<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//iOS 手机的内容</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>android<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//Android 手机的内容</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>client<span class="token punctuation">.</span>system<span class="token punctuation">.</span>nokiaN<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">//诺基亚手机的内容</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="小结"><a href="#小结" aria-hidden="true" class="header-anchor">#</a> 小结</h2> <p>客户端检测是JavaScript 开发中最具争议的一个话题。由于浏览器间存在差别，通常需要根据不同浏览器的能力分别编写不同的代码。</p> <ul><li><p>能力检测：在编写代码之前先检测特定浏览器的能力。</p></li> <li><p>怪癖检测：怪癖实际上是浏览器实现中存在的bug。</p></li> <li><p>用户代理检测：通过检测用户代理字符串来识别浏览器。</p></li></ul> <p>在决定使用哪种客户端检测方法时，一般应优先考虑使用能力检测。怪癖检测是确定应该如何处理代码的第二选择。而用户代理检测则是客户端检测的最后一种方案，因为这种方法对用户代理字符串具有很强的依赖性。</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/vuepress-4/assets/js/app.1a1f2688.js" defer></script><script src="/vuepress-4/assets/js/2.e8eb7698.js" defer></script><script src="/vuepress-4/assets/js/13.22e388ff.js" defer></script>
  </body>
</html>
